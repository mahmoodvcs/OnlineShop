@using MahtaKala.Models.StaffModels;
@*@model List<EskaadMerchandiseModel>*@
@{
	Layout = "~/Views/Shared/_Staff.cshtml";
	ViewBag.Title = "واحد بازرگانی";
}

@(Html.Kendo().Grid<EskaadMerchandiseModel>()
	.Name("Grid")
	.Columns(cols =>
	{
		cols.Bound(x => x.Code_Eskaad).Title("کد (اسکاد)");
		cols.Bound(x => x.Name_Eskaad).Title("نام (اسکاد)");
		cols.Bound(x => x.Unit_Eskaad).Title("واحد");
		cols.Bound(x => x.Count_Eskaad).Title("موجودی (اسکاد)");
		cols.Bound(x => x.Active_Eskaad).Title("فعال (اسکاد)");
		cols.Bound(x => x.Price_Eskaad).Title("قیمت");
		cols.Bound(x => x.Code_Mahta).Title("کد (مهتا)");
		cols.Bound(x => x.Name_Mahta).Title("نام (مهتا)");
		cols.Bound(x => x.Quantity_Mahta).Title("موجودی (مهتا)");
		cols.Bound(x => x.Status_Mahta).Title("وضعیت کالا (مهتا)");
		cols.Bound(x => x.IsPublished_Mahta).Title("منتشرشده (مهتا)");
		cols.Bound(x => x.PresentInEskaad).Title("موجود در اسکاد").ClientTemplate("#=PresentInEskaad?'بلی':'خیر'#");
		cols.Bound(x => x.PresentInMahta).Title("موجود در مهتا").ClientTemplate("#=PresentInMahta?'بلی':'خیر'#");
	}).Pageable(pageable => pageable
		.Refresh(true)
		.PageSizes(true)
		.PageSizes(new int[] { 5, 10, 20, 50 })
		.ButtonCount(5))
	.Sortable()
	.DataSource(datasource =>
		datasource.Ajax()
		.PageSize(50)
		.Read(read => read.Action("GetEskaadMerchandiseDataSource", "BusinessDept")))
	.Events(ev => ev.DataBound("onGridDataBound"))
)

@section js{ 
	<script type="text/javascript">
		function onGridDataBound(e) {
			var grid = this;
			var currentRecords = grid.dataSource.view();
			for (var i = 0; i < currentRecords.length; i++) {
				if (currentRecords[i].yellowWarningThreshold_Mahta > 0
					&& currentRecords[i].quantity_Mahta > 0
					&& currentRecords[i].quantity_Mahta <= currentRecords[i].yellowWarningThreshold_Mahta) {
					grid.tbody.find("tr[data-uid='" + currentRecords[i].uid + "']").HtmlAttributes["style"] = "background:yellow";
				}
			}
		}
	</script>
}
