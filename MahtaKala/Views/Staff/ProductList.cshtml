@{
    ViewData["Title"] = ViewData["Title"];
    Layout = "~/Views/Shared/_Staff.cshtml";
}
<div class="filterPanel">
    <fieldset>
        <legend>فیلتر ها:</legend>
        <div class="row">
            <div class="col-lg-3">
                <label>عنوان:</label>
                <input type="text" name="nameFilter" class="form-control additionalData" />
            </div>
            <div class="col-lg-3">
                <label>دسته بندی:</label>
                <input type="text" name="categoryFilter" class="form-control additionalData" />
            </div>
            <div class="col-lg-3">
                <label>وضعیت</label>
                @(Html.EnumCombo<ProductStatus>("stateFilter", showEmptyValue: true, isGridAdditionalData: true))
            </div>
        </div>
    </fieldset>

</div>


@(Html.Kendo().Grid<MahtaKala.Entities.Models.ProductListModel>().Name("grid").Columns(columns =>
{
    columns.Bound(p => p.Id).Title("شناسه");
    columns.Bound(p => p.Title).Title("عنوان");
    columns.Bound(p => p.Categories).Title("دسته بندی").Filterable(false).Sortable(false);
    columns.Bound(p => p.Price).Title("قیمت");
    columns.Bound(p => p.Status).Title("وضعیت").Filterable(false);
    columns.Bound(p => p.Published).ClientTemplate("#=Published?'بلی':'خیر'#").Title("منتشر شده");
    columns.Command(command => command.Custom("ویرایش").Click("EditQuestion")).Width(90);
    columns.Command(command => command.Custom("حذف").Click("RemoveQuestion")).Width(90);

})
    .ToolBar(toolbar =>
    {
        toolbar.ClientTemplateId("GridToolbarTemplate");
    })
    .Pageable(pageable => pageable
        .Refresh(true)
        .PageSizes(true)
        .PageSizes(new int[] { 5, 10, 20, 50 })
        .ButtonCount(5))
    .Filterable()
    .Sortable()
    .DataSource(dataSource => dataSource
        .Ajax()
        .PageSize(50)
        .Model(model =>
        {
            model.Id(p => p.Id);

        })
        .Read(read => read.Action("Product_Read", "Staff").Data("getAdditionalData"))
    ).Selectable()

)
<script id="GridToolbarTemplate" type="text/x-kendo-template">
    <div class="refreshBtnContainer">
        <a href="##" onclick="window.open('@Url.Content("~/Staff/Product")'); return false;" class="k-pager-refresh k-link k-button">
            <span class="k-icon k-i-add"></span>
            جدید
        </a>
    </div>
</script>
@section js{
    <script type="text/javascript">

        function EditQuestion(e) {
            e.preventDefault();
            var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
            var url = '@Url.Content("~/Staff/Product/")' + dataItem.Id;
            window.open(
                url,
                '_blank'
            );
        }

        function ShowItem(e) {
           e.preventDefault();
           var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
            var url = '@Url.Content("~/Staff/ProductItem/")' + dataItem.Id;
            window.open(
                url,
                '_blank'
            );
        }


        function RemoveQuestion(e) {
            e.preventDefault();
            var id = this.dataItem($(e.currentTarget).closest("tr")).Id;
            swal.fire({
                title: "از حذف این آیتم مطمئن هستید؟",
                text: "در صورتی که برای این آیتم رکوردی درج شده باشد حذف می شود و این کار غیر قابل بازگشت می باشد",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "بلی مطمئنم",
                cancelButtonText: "انصراف می دم",
                closeOnConfirm: false,
                closeOnCancel: true
            }).then(function (result) {
                if (result.value) {
                        $.ajax({
                            url: '@Url.Content("~/Staff/Product_Destroy/")' + id,
                            dataType: "json",
                            type: "POST",
                            contentType: 'application/json; charset=utf-8',
                            cache: false,
                            success: function (data) {

                                if (data.success) {
                                    var grid = $("#grid").data("kendoGrid");
                                    grid.dataSource.read();
                                    swal.fire("حذف رکورد با موفقیت انجام شد", "", "success");
                                }
                                else {
                                    swal.fire(data.message, "", "warning");
                                }
                            },
                            error: function (xhr) {
                                swal.fire("خطایی  در حذف اطلاعات اتفاق افتاده است", "", "warning");
                            }
                        });
                    }
                });
        }
    </script>
}
